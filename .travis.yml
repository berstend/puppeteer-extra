language: node_js
dist: trusty
addons:
  apt:
    packages:
      # This is required to run new chrome on old trusty
      - libnss3

language: node_js

# allow headful tests
before_install:
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"

# test against multiple node versions
node_js:
- '10'
- '9'
- '8'
- '7'

# test against multiple puppeteer versions
env:
  - PUPPETEER_VERSION=next
  - PUPPETEER_VERSION=1.4.0
  - PUPPETEER_VERSION=1.3.0

script:
  - yarn
  # https://github.com/yarnpkg/yarn/issues/4731
  - 'if [ "$PUPPETEER_VERSION" = "next" ]; then lerna exec -- yarn remove puppeteer --dev && rm -rf yarn.lock; fi'
  - 'if [ "$PUPPETEER_VERSION" = "next" ]; then yarn add puppeteer@next --ignore-workspace-root-check; fi'
  - 'if [ "$PUPPETEER_VERSION" = "1.4.0" ]; then yarn add puppeteer@1.4.0 --ignore-workspace-root-check; fi'
  - 'if [ "$PUPPETEER_VERSION" = "1.3.0" ]; then yarn add puppeteer@1.3.0 --ignore-workspace-root-check; fi'
  - yarn list puppeteer
  - yarn test
